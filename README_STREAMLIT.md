# 画师预览管理器 - Streamlit版

这是一个基于Streamlit的Web界面，用于管理和预览画师信息。相比原来的HTML版本，具有更好的交互性和数据管理功能。

## 🌟 主要特性

- **Web界面**: 基于Streamlit的现代化Web界面
- **JSON数据存储**: 使用JSON格式存储数据，便于导出导入
- **预览图获取**: 自动从网站获取画师作品预览图
- **批量操作**: 支持批量选择、导出等操作
- **数据导入导出**: 支持YAML、JSON、文本格式的数据导入导出
- **实时搜索**: 支持实时搜索和筛选功能
- **分页显示**: 大量数据的分页显示

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements_streamlit.txt
```

或者直接运行启动脚本（会自动安装依赖）：

```bash
python start_streamlit.py
```

### 2. 启动应用

方式一：使用启动脚本
```bash
python start_streamlit.py
```

方式二：直接使用streamlit命令
```bash
streamlit run src/previewa/scripts/artist_preview_streamlit.py
```

### 3. 访问界面

启动后，在浏览器中访问：http://localhost:8501

## 📖 使用说明

### 数据导入

1. **YAML导入**: 在侧边栏选择YAML文件导入（兼容原有格式）
2. **JSON导入**: 导入之前导出的JSON数据文件
3. **文本导入**: 直接输入画师名称列表进行批量选择

### 数据管理

- **搜索筛选**: 在搜索框中输入关键词筛选画师
- **类型筛选**: 选择显示"全部"、"已存在"或"新画师"
- **预览筛选**: 根据是否有预览图进行筛选
- **分页浏览**: 支持大量数据的分页显示

### 预览图管理

- **批量生成**: 点击"生成预览图"按钮为所有新画师获取预览图
- **单独刷新**: 为单个画师重新获取预览图
- **缓存机制**: 自动缓存已获取的预览图，避免重复请求

### 数据导出

1. **选中画师**: 导出选中画师的名称列表
2. **选中文件**: 导出选中画师的所有文件名
3. **完整数据**: 导出包含所有信息的JSON文件

### 快速操作

- **全选/全不选**: 一键选择或取消选择所有画师
- **选择无预览**: 自动选择没有预览图的新画师
- **反选**: 反转当前选择状态

## 🗂️ 数据结构

### JSON数据格式

```json
[
  {
    "name": "画师名称",
    "folder": "文件夹名称",
    "preview_url": "预览图URL",
    "files": ["文件1.zip", "文件2.rar"],
    "is_existing": false,
    "selected": false,
    "has_preview": true
  }
]
```

### 缓存数据格式

```json
{
  "画师名称": "预览图URL"
}
```

## ⚙️ 配置选项

### 基本设置

- **搜索网站URL**: 预览图搜索的目标网站
- **每页显示数量**: 分页显示的数量（10/25/50/100）

### 高级设置（在配置文件中）

- **缓存过期时间**: 预览图缓存的有效期
- **并发请求数**: 同时进行的网络请求数量
- **请求延迟**: 请求之间的延迟时间
- **支持的文件格式**: 识别的压缩包格式

## 📁 目录结构

```
├── src/previewa/scripts/
│   ├── artist_preview_streamlit.py  # Streamlit应用主文件
│   └── data/                        # 数据目录
│       ├── artists.json            # 画师数据
│       ├── preview_cache.json      # 预览图缓存
│       ├── settings.json           # 用户设置
│       └── default_settings.json   # 默认设置
├── requirements_streamlit.txt       # 依赖列表
├── start_streamlit.py              # 启动脚本
└── README_STREAMLIT.md             # 使用说明
```

## 🔧 开发说明

### 主要组件

1. **DataManager**: 负责JSON数据的读写操作
2. **PreviewGenerator**: 负责从网站获取预览图
3. **ArtistInfo**: 画师信息的数据类
4. **main()**: Streamlit应用的主函数

### 异步处理

应用使用异步IO来提高预览图获取的效率，支持并发请求多个预览图。

### 缓存机制

- 预览图URL会被缓存，避免重复请求
- 设置和数据会持久化保存
- 支持缓存过期和手动刷新

## 🐛 故障排除

### 常见问题

1. **预览图加载失败**
   - 检查网络连接
   - 确认目标网站可访问
   - 尝试手动刷新单个预览图

2. **数据导入失败**
   - 检查文件格式是否正确
   - 确认文件编码为UTF-8
   - 查看错误日志信息

3. **界面加载慢**
   - 减少每页显示数量
   - 清理预览图缓存
   - 检查网络连接速度

### 日志查看

日志文件位置：`logs/artist_preview_streamlit/`

## 📝 更新日志

### v2.0.0
- 从HTML界面迁移到Streamlit
- 使用JSON格式存储数据
- 添加实时搜索和筛选
- 改进批量操作功能
- 优化异步预览图获取
- 增强数据导入导出功能

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目。

## 📄 许可证

MIT License
